{% extends "base.html" %}

{% block title %}Grid Connection - Lunar Vault{% endblock %}

{% block content %}
<div class="analytics-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-navigation">
            <button onclick="history.back()" class="back-btn glass-panel">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Dashboard</span>
            </button>
        </div>
        <div class="header-content">
            <h1 class="page-title">
                <i class="fas fa-plug animate-glow icon-grid-color" aria-label="Grid Connection Icon"></i>
                Grid Connection Analysis
            </h1>
            <p class="page-subtitle">Monitor your grid interactions and optimize energy flows</p>
        </div>
        <div class="header-stats">
            <div class="stat-item holographic">
                <div class="stat-value" id="grid-status">Connected</div>
                <div class="stat-label">Grid Status</div>
            </div>
            <div class="stat-item holographic">
                <div class="stat-value" id="current-flow">0.0 kW</div>
                <div class="stat-label">Current Flow</div>
            </div>
            <div class="stat-item holographic">
                <div class="stat-value" id="grid-frequency">60.0 Hz</div>
                <div class="stat-label">Frequency</div>
            </div>
        </div>
    </div>
    
    <!-- Real-Time Grid Status -->
    <section class="grid-status-section">
        <div class="status-grid">
            <!-- Connection Health -->
            <div class="status-card glass-panel">
                <div class="status-header">
                    <h3>Connection Health</h3>
                    <div class="health-indicator" id="health-indicator">
                        <div class="health-pulse"></div>
                        <span class="health-status">Excellent</span>
                    </div>
                </div>
                <div class="status-metrics">
                    <div class="metric-row">
                        <span>Voltage</span>
                        <span id="grid-voltage" class="metric-value">240.2 V</span>
                    </div>
                    <div class="metric-row">
                        <span>Frequency</span>
                        <span id="grid-freq" class="metric-value">60.02 Hz</span>
                    </div>
                    <div class="metric-row">
                        <span>Power Factor</span>
                        <span id="power-factor" class="metric-value">0.98</span>
                    </div>
                    <div class="metric-row">
                        <span>Uptime</span>
                        <span id="grid-uptime" class="metric-value">99.94%</span>
                    </div>
                </div>
            </div>
            
            <!-- Current Flow Direction -->
            <div class="status-card glass-panel">
                <div class="status-header">
                    <h3>Energy Flow</h3>
                    <div class="flow-direction" id="flow-direction">
                        <i class="fas fa-arrow-right flow-icon"></i>
                        <span class="flow-status">Importing</span>
                    </div>
                </div>
                <div class="flow-visualization" id="flow-visualization">
                    <!-- Flow visualization will be created by JavaScript -->
                </div>
                <div class="flow-details">
                    <div class="detail-item">
                        <span>Current Rate</span>
                        <span id="flow-rate" class="detail-value">2.4 kW</span>
                    </div>
                    <div class="detail-item">
                        <span>Daily Import</span>
                        <span id="daily-import" class="detail-value">12.8 kWh</span>
                    </div>
                    <div class="detail-item">
                        <span>Daily Export</span>
                        <span id="daily-export" class="detail-value">8.6 kWh</span>
                    </div>
                </div>
            </div>
            
            <!-- Net Metering -->
            <div class="status-card glass-panel">
                <div class="status-header">
                    <h3>Net Metering</h3>
                    <div class="metering-balance" id="metering-balance">
                        <span class="balance-amount">+4.2 kWh</span>
                        <span class="balance-label">Net Export Today</span>
                    </div>
                </div>
                <div class="metering-details">
                    <div class="detail-row">
                        <span>Export Rate</span>
                        <span class="detail-value">$0.08/kWh</span>
                    </div>
                    <div class="detail-row">
                        <span>Import Rate</span>
                        <span class="detail-value">$0.12/kWh</span>
                    </div>
                    <div class="detail-row">
                        <span>Today's Credit</span>
                        <span class="detail-value credit">+$0.69</span>
                    </div>
                    <div class="detail-row">
                        <span>Monthly Credit</span>
                        <span class="detail-value credit">+$18.42</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Grid Import/Export Chart -->
    <section class="main-chart-section">
        <div class="glass-panel chart-container">
            <div class="chart-header">
                <h2 class="chart-title">
                    <i class="fas fa-chart-area icon-grid-color" aria-label="Chart Icon"></i>
                    Grid Import/Export Trends
                </h2>
                <div class="chart-controls">
                    <div class="chart-filters">
                        <button class="filter-btn active" data-period="day">24 Hours</button>
                        <button class="filter-btn" data-period="week">7 Days</button>
                        <button class="filter-btn" data-period="month">30 Days</button>
                        <button class="filter-btn" data-period="year">12 Months</button>
                    </div>
                    <div class="chart-actions">
                        <button class="action-btn" onclick="exportGridData()">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                        <button class="action-btn" onclick="generateGridReport()">
                            <i class="fas fa-file-pdf"></i>
                            Grid Report
                        </button>
                    </div>
                </div>
            </div>
            <div class="chart-canvas-container">
                <canvas id="grid-chart"></canvas>
            </div>
        </div>
    </section>
    
    <!-- Grid Performance Metrics -->
    <section class="performance-section">
        <div class="performance-grid">
            <!-- Monthly Summary -->
            <div class="performance-card glass-panel">
                <div class="card-header">
                    <h3>Monthly Summary</h3>
                    <i class="fas fa-calendar-month icon-accent-primary"></i>
                </div>
                <div class="summary-stats">
                    <div class="summary-item">
                        <div class="summary-label">Total Import</div>
                        <div class="summary-value import">342.8 kWh</div>
                        <div class="summary-cost">$41.14</div>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-item">
                        <div class="summary-label">Total Export</div>
                        <div class="summary-value export">287.6 kWh</div>
                        <div class="summary-credit">+$23.01</div>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-item">
                        <div class="summary-label">Net Usage</div>
                        <div class="summary-value net">55.2 kWh</div>
                        <div class="summary-net-cost">$18.13</div>
                    </div>
                </div>
                <div class="summary-comparison">
                    <span class="comparison-text">
                        <i class="fas fa-arrow-down icon-battery-color"></i>
                        32% reduction vs. last month
                    </span>
                </div>
            </div>
            
            <!-- Peak Demand Management -->
            <div class="performance-card glass-panel">
                <div class="card-header">
                    <h3>Peak Demand Management</h3>
                    <i class="fas fa-tachometer-alt icon-accent-tertiary"></i>
                </div>
                <div class="demand-info">
                    <div class="demand-current">
                        <span class="demand-label">Current Demand</span>
                        <span class="demand-value">7.2 kW</span>
                    </div>
                    <div class="demand-peak">
                        <span class="demand-label">Monthly Peak</span>
                        <span class="demand-value peak">12.8 kW</span>
                    </div>
                    <div class="demand-chart" id="demand-chart">
                        <!-- Mini demand chart -->
                    </div>
                </div>
                <div class="demand-savings">
                    <span class="savings-text">
                        <i class="fas fa-piggy-bank icon-battery-color"></i>
                        Peak shaving saved $24.60 this month
                    </span>
                </div>
            </div>
            
            <!-- Grid Quality Metrics -->
            <div class="performance-card glass-panel">
                <div class="card-header">
                    <h3>Power Quality</h3>
                    <i class="fas fa-wave-square icon-accent-secondary"></i>
                </div>
                <div class="quality-metrics">
                    <div class="quality-item">
                        <span class="quality-label">Voltage Stability</span>
                        <div class="quality-bar">
                            <div class="quality-fill quality-fill-97"></div>
                        </div>
                        <span class="quality-value">97%</span>
                    </div>
                    <div class="quality-item">
                        <span class="quality-label">Frequency Stability</span>
                        <div class="quality-bar">
                            <div class="quality-fill quality-fill-99"></div>
                        </div>
                        <span class="quality-value">99%</span>
                    </div>
                    <div class="quality-item">
                        <span class="quality-label">Harmonic Distortion</span>
                        <div class="quality-bar">
                            <div class="quality-fill quality-fill-95"></div>
                        </div>
                        <span class="quality-value">< 2%</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Rate Schedule & Optimization -->
    <section class="rates-section">
        <div class="glass-panel">
            <h2 class="chart-title">
                <i class="fas fa-clock icon-accent-tertiary"></i>
                Rate Schedule & Optimization
            </h2>
            <div class="rates-content">
                <div class="rate-schedule" id="rate-schedule">
                    <!-- Rate schedule will be populated by JavaScript -->
                </div>
                <div class="optimization-tips">
                    <h4>Optimization Opportunities</h4>
                    <div id="rate-optimization-tips" class="tips-list">
                        <!-- Tips will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Grid Events & Alerts -->
    <section class="events-section">
        <div class="glass-panel">
            <h2 class="chart-title">
                <i class="fas fa-bell icon-accent-primary"></i>
                Grid Events & Alerts
            </h2>
            <div id="grid-events" class="events-container">
                <!-- Events will be populated by JavaScript -->
            </div>
        </div>
    </section>
</div>

<style>
.grid-status-section {
    margin-bottom: 40px;
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
}

.status-card {
    padding: 25px;
    transition: all 0.3s ease;
}

.status-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px var(--hologram-glow);
}

.status-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.status-header h3 {
    font-size: 1.2rem;
    color: var(--text-primary);
}

.health-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
}

.health-pulse {
    width: 12px;
    height: 12px;
    background: var(--battery-color);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.health-status {
    font-weight: 600;
    color: var(--battery-color);
}

.status-metrics {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.metric-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.metric-row:last-child {
    border-bottom: none;
}

.metric-value {
    font-weight: 600;
    color: var(--text-primary);
}

.flow-direction {
    display: flex;
    align-items: center;
    gap: 8px;
}

.flow-icon {
    color: var(--grid-color);
    animation: flow-pulse 2s infinite;
}

@keyframes flow-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
}

.flow-status {
    font-weight: 600;
    color: var(--grid-color);
}

.flow-visualization {
    height: 60px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--grid-color) 50%, 
        transparent 100%);
    border-radius: 30px;
    margin: 20px 0;
    position: relative;
    overflow: hidden;
}

.flow-visualization::after {
    content: '';
    position: absolute;
    top: 50%;
    left: -20px;
    width: 40px;
    height: 4px;
    background: white;
    transform: translateY(-50%);
    animation: flow-animation 2s infinite;
}

@keyframes flow-animation {
    0% { left: -20px; }
    100% { left: 100%; }
}

.flow-details {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.detail-item,
.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
}

.detail-value {
    font-weight: 600;
    color: var(--text-primary);
}

.metering-balance {
    text-align: center;
}

.balance-amount {
    display: block;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--battery-color);
    margin-bottom: 5px;
}

.balance-label {
    font-size: 0.9rem;
    color: var(--text-muted);
}

.metering-details {
    margin-top: 20px;
}

.credit {
    color: var(--battery-color) !important;
}

.performance-section {
    margin: 40px 0;
}

.performance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
}

.performance-card {
    padding: 25px;
    transition: all 0.3s ease;
}

.performance-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px var(--hologram-glow);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.card-header h3 {
    font-size: 1.2rem;
    color: var(--text-primary);
}

.summary-stats {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.summary-item {
    text-align: center;
    flex: 1;
}

.summary-divider {
    width: 1px;
    height: 60px;
    background: rgba(255, 255, 255, 0.1);
    margin: 0 15px;
}

.summary-label {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.summary-value {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.summary-value.import {
    color: #ef4444;
}

.summary-value.export {
    color: var(--battery-color);
}

.summary-value.net {
    color: var(--accent-primary);
}

.summary-cost,
.summary-credit,
.summary-net-cost {
    font-size: 0.9rem;
}

.summary-cost,
.summary-net-cost {
    color: #ef4444;
}

.summary-credit {
    color: var(--battery-color);
}

.summary-comparison {
    text-align: center;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.comparison-text {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.demand-info {
    margin-bottom: 20px;
}

.demand-current,
.demand-peak {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.demand-label {
    color: var(--text-secondary);
}

.demand-value {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--text-primary);
}

.demand-value.peak {
    color: var(--accent-tertiary);
}

.demand-chart {
    height: 60px;
    background: linear-gradient(90deg,
        var(--battery-color) 0%,
        var(--battery-color) 40%,
        var(--accent-tertiary) 40%,
        var(--accent-tertiary) 60%,
        var(--battery-color) 60%,
        var(--battery-color) 100%);
    border-radius: 8px;
    margin: 15px 0;
    position: relative;
}

.demand-chart::after {
    content: 'Peak Hours';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.8rem;
    color: white;
    font-weight: 600;
}

.demand-savings {
    text-align: center;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.savings-text {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.quality-metrics {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.quality-item {
    display: flex;
    align-items: center;
    gap: 15px;
}

.quality-label {
    flex: 1;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.quality-bar {
    flex: 2;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
}

.quality-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 1s ease;
}

.quality-value {
    font-weight: 600;
    color: var(--text-primary);
    min-width: 50px;
    text-align: right;
}

.rates-section {
    margin: 40px 0;
}

.rates-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-top: 25px;
}

.rate-schedule {
    display: grid;
    grid-template-columns: repeat(24, 1fr);
    gap: 2px;
    height: 60px;
}

.rate-hour {
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    color: white;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
}

.rate-hour:hover {
    transform: scale(1.1);
    z-index: 10;
}

.rate-off-peak {
    background: var(--battery-color);
}

.rate-mid-peak {
    background: var(--accent-tertiary);
}

.rate-on-peak {
    background: #ef4444;
}

.optimization-tips {
    padding-left: 20px;
    border-left: 2px solid var(--accent-primary);
}

.optimization-tips h4 {
    margin-bottom: 15px;
    color: var(--text-primary);
}

.tips-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.tip-item {
    padding: 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    border-left: 3px solid var(--accent-primary);
}

.tip-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 5px;
}

.tip-description {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.events-section {
    margin: 40px 0;
}

.events-container {
    margin-top: 25px;
}

.event-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    margin-bottom: 15px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border-left: 4px solid var(--accent-primary);
    transition: all 0.3s ease;
}

.event-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateX(5px);
}

.event-icon {
    font-size: 1.5rem;
    color: var(--accent-primary);
}

.event-content {
    flex: 1;
}

.event-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 5px;
}

.event-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.event-time {
    font-size: 0.8rem;
    color: var(--text-muted);
}

@media (max-width: 768px) {
    .page-header {
        grid-template-columns: 1fr;
        text-align: center;
        gap: 20px;
    }
    
    .status-grid,
    .performance-grid {
        grid-template-columns: 1fr;
    }
    
    .rates-content {
        grid-template-columns: 1fr;
    }
    
    .rate-schedule {
        grid-template-columns: repeat(12, 1fr);
        height: 120px;
    }
    
    .summary-stats {
        flex-direction: column;
        gap: 20px;
    }
    
    .summary-divider {
        width: 100%;
        height: 1px;
        margin: 0;
    }
}

@media (max-width: 480px) {
    .rate-schedule {
        grid-template-columns: repeat(6, 1fr);
        height: 240px;
    }
}
</style>

<script>
function exportGridData() {
    const today = new Date().toISOString().split('T')[0];
    const csvContent = `Date,Time,Import (kW),Export (kW),Voltage (V),Frequency (Hz),Power Factor
${today},00:00,2.4,0.0,240.1,60.01,0.98
${today},06:00,3.8,0.0,239.8,60.02,0.97
${today},12:00,0.0,4.2,240.3,59.99,0.99
${today},18:00,1.8,0.0,240.0,60.00,0.98`;
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'grid_connection_data.csv';
    a.click();
    window.URL.revokeObjectURL(url);
}

function generateGridReport() {
    alert('Generating comprehensive grid analysis report... This would create a detailed PDF with connection metrics, power quality analysis, and optimization recommendations.');
}

// Initialize page content
document.addEventListener('DOMContentLoaded', function() {
    updateGridMetrics();
    generateRateSchedule();
    generateOptimizationTips();
    generateGridEvents();
    startRealTimeUpdates();
});

function updateGridMetrics() {
    document.getElementById('grid-status').textContent = 'Connected';
    document.getElementById('current-flow').textContent = '2.4 kW';
    document.getElementById('grid-frequency').textContent = '60.02 Hz';
    document.getElementById('grid-voltage').textContent = '240.2 V';
    document.getElementById('grid-freq').textContent = '60.02 Hz';
    document.getElementById('power-factor').textContent = '0.98';
    document.getElementById('grid-uptime').textContent = '99.94%';
    document.getElementById('flow-rate').textContent = '2.4 kW';
    document.getElementById('daily-import').textContent = '12.8 kWh';
    document.getElementById('daily-export').textContent = '8.6 kWh';
}

function generateRateSchedule() {
    const schedule = document.getElementById('rate-schedule');
    const rates = [
        // Hour 0-5: Off-peak
        ...Array(6).fill('off-peak'),
        // Hour 6-8: Mid-peak
        ...Array(3).fill('mid-peak'),
        // Hour 9-16: Off-peak
        ...Array(8).fill('off-peak'),
        // Hour 17-20: On-peak
        ...Array(4).fill('on-peak'),
        // Hour 21-23: Mid-peak
        ...Array(3).fill('mid-peak')
    ];
    
    const rateLabels = {
        'off-peak': '$0.08',
        'mid-peak': '$0.12',
        'on-peak': '$0.18'
    };
    
    schedule.innerHTML = rates.map((rate, hour) => `
        <div class="rate-hour rate-${rate}" title="Hour ${hour}: ${rateLabels[rate]}/kWh">
            ${hour}
        </div>
    `).join('');
}

function generateOptimizationTips() {
    const tips = [
        {
            title: 'Shift High-Energy Tasks',
            description: 'Move energy-intensive activities to off-peak hours (9 AM - 4 PM) to save up to 55% on electricity costs.'
        },
        {
            title: 'Maximize Solar Export',
            description: 'Your peak solar production (11 AM - 2 PM) aligns with off-peak rates. Export excess to maximize savings.'
        },
        {
            title: 'Battery Timing Optimization',
            description: 'Charge your battery during off-peak hours and discharge during on-peak hours for maximum benefit.'
        },
        {
            title: 'Load Scheduling',
            description: 'Schedule EV charging, water heating, and HVAC pre-cooling for off-peak periods.'
        }
    ];
    
    const container = document.getElementById('rate-optimization-tips');
    container.innerHTML = tips.map(tip => `
        <div class="tip-item">
            <div class="tip-title">${tip.title}</div>
            <div class="tip-description">${tip.description}</div>
        </div>
    `).join('');
}

function generateGridEvents() {
    const events = [
        {
            icon: 'fas fa-info-circle',
            title: 'Planned Maintenance',
            description: 'Grid maintenance scheduled for tomorrow 2:00 AM - 4:00 AM. Backup power will be automatically activated.',
            time: '1 hour ago'
        },
        {
            icon: 'fas fa-check-circle',
            title: 'Peak Demand Avoided',
            description: 'Your solar and battery system successfully avoided peak demand charges during today\'s high usage period.',
            time: '3 hours ago'
        },
        {
            icon: 'fas fa-exclamation-triangle',
            title: 'Voltage Fluctuation',
            description: 'Minor voltage fluctuation detected at 14:32. System automatically compensated with no impact to home power.',
            time: '1 day ago'
        },
        {
            icon: 'fas fa-dollar-sign',
            title: 'Export Credit Milestone',
            description: 'Congratulations! You\'ve reached $100 in grid export credits this month - 25% ahead of last month.',
            time: '2 days ago'
        }
    ];
    
    const container = document.getElementById('grid-events');
    container.innerHTML = events.map(event => `
        <div class="event-item">
            <i class="${event.icon} event-icon"></i>
            <div class="event-content">
                <div class="event-title">${event.title}</div>
                <div class="event-description">${event.description}</div>
            </div>
            <div class="event-time">${event.time}</div>
        </div>
    `).join('');
}

function startRealTimeUpdates() {
    // Simulate real-time updates of grid metrics
    // Store interval ID to allow cleanup
    if (window.gridUpdateInterval) {
        clearInterval(window.gridUpdateInterval);
    }
    window.gridUpdateInterval = setInterval(() => {
        // Update flow direction randomly
        const isImporting = Math.random() > 0.6;
        const flowDirection = document.getElementById('flow-direction');
        const flowIcon = flowDirection.querySelector('.flow-icon');
        const flowStatus = flowDirection.querySelector('.flow-status');
        
        if (isImporting) {
            flowIcon.className = 'fas fa-arrow-right flow-icon';
            flowStatus.textContent = 'Importing';
            flowStatus.classList.remove('flow-status-export');
            flowStatus.classList.add('flow-status-import');
        } else {
            flowIcon.className = 'fas fa-arrow-left flow-icon';
            flowStatus.textContent = 'Exporting';
            flowStatus.classList.remove('flow-status-import');
            flowStatus.classList.add('flow-status-export');
        }
        
        // Update flow rate
        const rate = (Math.random() * 5).toFixed(1);
        document.getElementById('flow-rate').textContent = `${rate} kW`;
        
        // Update voltage and frequency with small variations
        const voltage = (240 + (Math.random() - 0.5) * 2).toFixed(1);
        const frequency = (60 + (Math.random() - 0.5) * 0.1).toFixed(2);
        
        document.getElementById('grid-voltage').textContent = `${voltage} V`;
        document.getElementById('grid-freq').textContent = `${frequency} Hz`;
        
    }, 5000);
}
</script>
{% endblock %}
